<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NR-AES</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3f37c9;
            --accent: #4895ef;
            --success: #4cc9f0;
            --error: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --radius: 16px;
            --shadow: 0 12px 24px rgba(0,0,0,0.1);
            --transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--dark);
            overflow: hidden;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            position: relative;
        }

        /* å¤´éƒ¨ */
        .header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 28px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content {
            padding: 30px;
        }

        /* æ ‡ç­¾é¡µ */
        .tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid #e9ecef;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            position: relative;
            transition: var(--transition);
            color: #6c757d;
        }

        .tab.active {
            color: var(--primary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* è¡¨å•ç»„ */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        input, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ced4da;
            border-radius: var(--radius);
            font-size: 15px;
            transition: var(--transition);
        }

        input:focus, textarea:focus {
            border-color: var(--accent);
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        /* æŒ‰é’® */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 500;
            font-size: 15px;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* ç»“æœå®¹å™¨ */
        .result-container {
            margin-top: 25px;
            border: 1px solid #e9ecef;
            border-radius: var(--radius);
            padding: 15px;
            background: #f8f9fa;
            position: relative;
        }

        .result-container h3 {
            margin-bottom: 10px;
            font-size: 16px;
            color: var(--dark);
        }

        .copy-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--light);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .copy-btn:hover {
            background: #e9ecef;
        }

        /* æç¤ºæ¡† */
        .alert {
            padding: 12px 15px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .alert-success {
            background: rgba(76, 201, 240, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .alert-error {
            background: rgba(247, 37, 133, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }

        /* å±‚æ•°æ§åˆ¶ */
        .layer-controls {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .layer-btn {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: var(--light);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        /* ä¿®å¤å‡å·æŒ‰é’®ä¸çµæ•é—®é¢˜ */
        .layer-btn::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
        }

        .layer-btn:hover {
            background: #e9ecef;
        }

        .layer-btn.active {
            background: var(--primary);
            color: white;
        }

        .layer-display {
            font-size: 18px;
            font-weight: 500;
            min-width: 30px;
            text-align: center;
        }

        .layer-inputs {
            margin-top: 15px;
        }

        .layer-password {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .layer-password label {
            min-width: 100px;
            margin-bottom: 0;
            margin-right: 10px;
        }

        .layer-password input {
            flex: 1;
        }

        /* æ‰¾å›æ•°æ®æŒ‰é’® */
        .recovery-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 13px;
            cursor: pointer;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }

        .recovery-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* é”™è¯¯ç•Œé¢ */
        .error-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .error-container.active {
            opacity: 1;
            pointer-events: all;
        }

        .error-icon {
            width: 100px;
            height: 100px;
            margin-bottom: 30px;
        }

        .error-icon path {
            stroke-width: 6;
            stroke: var(--error);
            fill: none;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }

        .error-message {
            font-size: 22px;
            font-weight: 500;
            margin-bottom: 30px;
            color: var(--dark);
        }

        .back-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
        }

        .back-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .back-btn:active {
            transform: translateY(0);
        }

        /* é”å®šç•Œé¢ */
        .lock-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .lock-container.active {
            opacity: 1;
            pointer-events: all;
        }

        .lock-icon {
            font-size: 80px;
            color: var(--error);
            margin-bottom: 20px;
        }

        .lock-message {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 10px;
            text-align: center;
            color: var(--dark);
        }

        .lock-timer {
            font-size: 18px;
            color: var(--gray);
            margin-bottom: 30px;
        }

        /* æ‰¾å›æ•°æ®ç•Œé¢ */
        .recovery-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }

        .recovery-container.active {
            opacity: 1;
            pointer-events: all;
        }

        .recovery-box {
            background: white;
            border-radius: var(--radius);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            transform: translateY(20px);
            transition: var(--transition);
        }

        .recovery-container.active .recovery-box {
            transform: translateY(0);
        }

        .recovery-header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .recovery-header h2 {
            font-weight: 600;
            font-size: 22px;
        }

        .close-recovery {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .recovery-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .recovery-item {
            background: var(--light);
            border-radius: var(--radius);
            padding: 15px;
            margin-bottom: 15px;
        }

        .recovery-item h3 {
            margin-bottom: 10px;
            color: var(--primary);
            font-size: 16px;
        }

        .recovery-item p {
            margin-bottom: 8px;
            font-size: 14px;
        }

        .recovery-item .label {
            font-weight: 500;
            color: var(--dark);
            display: inline-block;
            min-width: 80px;
        }

        /* å¯†ç éªŒè¯ç•Œé¢ */
        .auth-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .auth-header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 28px;
            text-align: center;
            width: 100%;
            max-width: 400px;
        }

        .auth-header h1 {
            font-weight: 600;
            font-size: 26px;
            margin-bottom: 6px;
        }

        .auth-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .auth-body {
            padding: 30px;
            width: 100%;
            max-width: 400px;
        }

        .auth-title {
            text-align: center;
            margin-bottom: 24px;
            font-size: 18px;
            color: var(--dark);
        }

        .password-display {
            width: 100%;
            height: 60px;
            background: var(--light);
            border-radius: var(--radius);
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            letter-spacing: 4px;
            color: var(--dark);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .password-display::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
            transform: scaleX(0);
            transform-origin: left;
            transition: var(--transition);
        }

        .password-display.active::after {
            transform: scaleX(1);
        }

        .numpad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .num-btn {
            aspect-ratio: 1;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 22px;
            font-weight: 500;
            color: var(--dark);
            cursor: pointer;
            transition: var(--transition);
            user-select: none;
            position: relative;
        }

        /* ä¿®å¤æŒ‰é’®ç‚¹å‡»åŒºåŸŸ */
        .num-btn::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
        }

        .num-btn:hover {
            background: var(--light);
            transform: translateY(-2px);
        }

        .num-btn:active {
            transform: translateY(0);
            background: #e9ecef;
        }

        .num-btn.empty {
            visibility: hidden;
        }

        .submit-btn {
            grid-column: span 3;
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 30px;
            font-weight: 500;
            font-size: 16px;
            margin-top: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .submit-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        /* éªŒè¯åŠ¨ç”» */
        .checkmark {
            width: 100px;
            height: 100px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            z-index: 210;
            pointer-events: none;
        }

        .checkmark path {
            stroke-width: 6;
            stroke: var(--success);
            fill: none;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }

        .crossmark {
            width: 100px;
            height: 100px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            z-index: 210;
            pointer-events: none;
        }

        .crossmark path {
            stroke-width: 6;
            stroke: var(--error);
            fill: none;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }

        @keyframes draw {
            to { stroke-dashoffset: 0; }
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                border-radius: 0;
                max-width: 100%;
                min-height: 100vh;
            }
            
            .content {
                padding: 20px;
            }
            
            .layer-password {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .layer-password label {
                margin-bottom: 5px;
            }
        }
        /* æ ¡éªŒç•Œé¢æ ·å¼ */
.checking-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: white;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999; /* ä¿è¯åœ¨æœ€ä¸Šå±‚ */
}
.checking-text {
  font-size: 24px;
  color: #333;
  margin-bottom: 30px;
  font-weight: 500;
}
/* æ—‹è½¬çš„è“è‰²åœ†åœˆ */
.spinner {
  width: 50px;
  height: 50px;
  border: 5px solid #e0e0e0; /* æµ…ç°è¾¹æ¡† */
  border-top: 5px solid #4361ee; /* è“è‰²é¡¶éƒ¨è¾¹æ¡†ï¼ˆæ—‹è½¬æ—¶ä¼šåŠ¨ï¼‰ */
  border-radius: 50%; /* åœ†å½¢ */
  animation: spin 1s linear infinite; /* æ—‹è½¬åŠ¨ç”» */
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
/* æ ¡éªŒä¸é€šè¿‡çš„æç¤º */
.failed-check {
  font-size: 28px;
  color: #f72585; /* çº¢è‰² */
  text-align: center;
  padding: 0 20px;
}
/* æ•°å­—æŒ‰é’®ï¼šåœ¨ç™½è‰²èƒŒæ™¯ä¸Šæ˜æ˜¾çš„æ¯›ç»ç’ƒ */
.num-btn {
  background: rgba(0, 0, 0, 0.1) !important; /* æ·±è‰²åŠé€æ˜ï¼ˆåœ¨ç™½è‰²ä¸Šæ˜æ˜¾ï¼‰ */
  backdrop-filter: blur(5px) !important; /* åŠ å¼ºæ¨¡ç³Š */
  border: 1px solid rgba(0, 0, 0, 0.15) !important; /* æ·±è‰²è¾¹æ¡† */
  color: #333 !important; /* æ·±ç°è‰²æ•°å­—ï¼ˆæ›´æ¸…æ™°ï¼‰ */
  border-radius: 50% !important;
}
.num-btn:hover {
  background: rgba(0, 0, 0, 0.15) !important; /*  hoveræ—¶æ·±ä¸€ç‚¹ */
}

/* ç¡®è®¤æŒ‰é’®ï¼šåŒºåˆ†æ˜æ˜¾ */
.submit-btn {
  background: rgba(67, 97, 238, 0.25) !important; /* è“è‰²åŠ æ·± */
  backdrop-filter: blur(10px) !important;
  border: 1px solid rgba(67, 97, 238, 0.4) !important; /* è¾¹æ¡†åŠ æ·± */
  color: #fff !important;
}
/* æŒ‰é’®ç‚¹å‡»å›å¼¹åŠ¨ç”» */
.num-btn, .submit-btn {
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
}

/* ç‚¹å‡»æ—¶ç¼©å°ï¼Œæ¾å¼€åå›å¼¹ */
.num-btn:active, .submit-btn:active {
  transform: scale(0.85) !important;
}
/* æŒ‰é’®åŸºç¡€é˜´å½±ï¼ˆå¸¸é©»ï¼‰ */
.num-btn, .submit-btn {
  position: relative;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05) !important; /* è½»å¾®é˜´å½± */
  overflow: hidden !important; /* è®©æ³¢çº¹ä¸è¶…å‡ºæŒ‰é’® */
}

/* æ³¢çº¹æ•ˆæœå®¹å™¨ */
.num-btn::after, .submit-btn::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  background: rgba(67, 97, 238, 0.1); /* è“è‰²æ³¢çº¹ */
  border-radius: 50%;
  transform: translate(-50%, -50%);
  transition: width 0.6s ease-out, height 0.6s ease-out !important;
  pointer-events: none; /* ä¸å½±å“ç‚¹å‡» */
  z-index: 1; /* æ³¢çº¹åœ¨æŒ‰é’®å†…éƒ¨ */
}

/* ç‚¹å‡»æ—¶è§¦å‘æ³¢çº¹æ‰©æ•£ */
.num-btn:active::after, .submit-btn:active::after {
  width: 200px; /* æ³¢çº¹æœ€å¤§å®½åº¦ */
  height: 200px; /* æ³¢çº¹æœ€å¤§é«˜åº¦ */
  opacity: 0; /* æ‰©æ•£åæ¶ˆå¤± */
}

/* ä¿æŒä¹‹å‰çš„å›å¼¹åŠ¨ç”»ï¼ˆå¦‚æœéœ€è¦ä¿ç•™ï¼‰ */
.num-btn, .submit-btn {
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
}
.num-btn:active, .submit-btn:active {
  transform: scale(0.85) !important;
}
.layer-inputs {
  max-height: 300px; /* æœ€å¤šæ˜¾ç¤º300åƒç´ é«˜ */
  overflow-y: auto; /* è¶…è¿‡300åƒç´ å°±å‡ºç°æ»šåŠ¨æ¡ */
  padding-right: 10px; /* æ»šåŠ¨æ¡ä¸æŒ¤å†…å®¹ */
}
/* æ¸…é™¤å†å²è®°å½•æŒ‰é’®æ ·å¼ */
.clear-history-btn {
  position: absolute; /* è®©æŒ‰é’®åœ¨æ ‡é¢˜æ å³ä¾§ */
  top: 15px; /* ä½ç½®ä¸Šä¸‹è°ƒæ•´ */
  right: 60px; /* ç¦»å…³é—­æŒ‰é’®ä¸€ç‚¹è·ç¦» */
  background: #f72585; /* çº¢è‰²èƒŒæ™¯ */
  color: white; /* ç™½è‰²æ–‡å­— */
  border: none; /* å»æ‰è¾¹æ¡† */
  padding: 6px 12px; /* æŒ‰é’®å¤§å° */
  border-radius: 30px; /* åœ†è§’ */
  font-size: 13px; /* æ–‡å­—å¤§å° */
  cursor: pointer; /* é¼ æ ‡æ”¾ä¸Šå»å˜æ‰‹å‹ */
  transition: background 0.3s; /* ç‚¹å‡»æ—¶é¢œè‰²å˜åŒ–æ›´æŸ”å’Œ */
}
/* é¼ æ ‡æ”¾ä¸Šå»é¢œè‰²å˜æ·±ä¸€ç‚¹ */
.clear-history-btn:hover {
  background: #d61a6f;
}
/* å†å²è®°å½•å°æ¡†æ ·å¼ */
.history-item {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
}

.history-item:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.history-item .content-preview {
    color: #333;
    font-size: 15px;
    max-width: 70%; /* é˜²æ­¢æ–‡å­—å¤ªé•¿ */
    white-space: nowrap; /* ä¸æ¢è¡Œ */
    overflow: hidden; /* è¶…å‡ºéšè— */
    text-overflow: ellipsis; /* æ˜¾ç¤º... */
}

.history-item .view-btn {
    background: #4361ee;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    cursor: pointer;
}
/* æ‰€æœ‰å¼¹çª—çš„é€šç”¨è¿‡æ¸¡ */
.modal {
  display: none; 
  opacity: 0; 
  transition: opacity 0.3s ease; 
  position: fixed;
  top: 0; 
  left: 0;
  width: 100%; 
  height: 100%;
  background: rgba(0,0,0,0.5);
}

/* æ˜¾ç¤ºçŠ¶æ€ */
.modal.show {
  display: block; 
  opacity: 1;
}
/* æŒ‰é’®ç‚¹å‡»ä¸æ»‘åé¦ˆï¼ˆé€‚é…æ‰€æœ‰æŒ‰é’®ï¼‰ */
.btn, .num-btn, .layer-btn, .view-btn, .clear-history-btn, .back-btn, .submit-btn {
  /* åŸºç¡€è¿‡æ¸¡ï¼šæ‰€æœ‰æ ·å¼å˜åŒ–éƒ½ä¸æ»‘è¿‡æ¸¡ */
  transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
  position: relative;
  overflow: hidden; /* ç”¨äºæ³¢çº¹æ•ˆæœ */
}

/* ç‚¹å‡»æ—¶ç¼©å°ï¼ˆå›å¼¹å‰çš„å‹ç¼©ï¼‰ */
.btn:active, .num-btn:active, .layer-btn:active, .view-btn:active, .clear-history-btn:active, .back-btn:active, .submit-btn:active {
  transform: scale(0.93); /* è½»å¾®ç¼©å° */
  box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* é˜´å½±å˜æµ… */
}

/* æŒ‰é’®é¢œè‰²åŠ æ·±ï¼ˆç‚¹å‡»æ—¶æ›´æ˜æ˜¾ï¼‰ */
.btn:active {
  background: #3652d8 !important; /* ä¸»æŒ‰é’®ç‚¹å‡»æ—¶æ›´æ·±çš„è“è‰² */
}
.num-btn:active {
  background: rgba(0,0,0,0.2) !important; /* æ•°å­—æŒ‰é’®ç‚¹å‡»æ—¶æ›´æ·±çš„ç°è‰² */
}
.clear-history-btn:active {
  background: #c21564 !important; /* çº¢è‰²æŒ‰é’®ç‚¹å‡»æ—¶æ›´æ·±çš„çº¢è‰² */
}

/* é¢å¤–åŠ ä¸ªâ€œæ³¢çº¹æ‰©æ•£â€æ•ˆæœï¼ˆç‚¹å‡»æ—¶ä»ä¸­å¿ƒæ•£å¼€ä¸€åœˆæ·¡è‰²ï¼‰ */
.btn::after, .num-btn::after, .layer-btn::after, .view-btn::after, .clear-history-btn::after, .back-btn::after, .submit-btn::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  background: rgba(255,255,255,0.3); /* ç™½è‰²åŠé€æ˜æ³¢çº¹ */
  border-radius: 50%;
  transform: translate(-50%, -50%);
  transition: width 0.6s ease, height 0.6s ease;
  pointer-events: none; /* ä¸å½±å“ç‚¹å‡» */
}

/* ç‚¹å‡»æ—¶è§¦å‘æ³¢çº¹æ‰©æ•£ */
.btn:active::after, .num-btn:active::after, .layer-btn:active::after, .view-btn:active::after, .clear-history-btn:active::after, .back-btn:active::after, .submit-btn:active::after {
  width: 200px; /* æ³¢çº¹æœ€å¤§å®½åº¦ */
  height: 200px; /* æ³¢çº¹æœ€å¤§é«˜åº¦ */
  opacity: 0; /* æ‰©æ•£åæ¶ˆå¤± */
}
input:focus, textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(72, 149, 239, 0.2); /* æ–°å¢ï¼šæ·¡è“è‰²å…‰æ™•æ‰©æ•£ */
  transition: all 0.3s ease; /* è®©é«˜äº®æ…¢æ…¢å‡ºç° */
}



    </style>
</head>
<body>
<!-- åŠ å¯†è§£å¯†ç»“æœå¼¹çª— -->
<div id="resultPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; justify-content: center; align-items: center;">
  <div style="background: white; width: 90%; max-width: 500px; padding: 25px; border-radius: 16px; box-shadow: 0 10px 20px rgba(0,0,0,0.2);">
    <h3 style="margin-bottom: 15px; color: #4361ee;">å¤„ç†ç»“æœ</h3>
    <div id="popupResultContent" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; min-height: 100px; word-break: break-all;"></div>
    <div style="display: flex; gap: 10px; margin-top: 20px;">
      <button id="copyPopupBtn" style="flex: 1; padding: 12px; background: #4361ee; color: white; border: none; border-radius: 30px; cursor: pointer;">å¤åˆ¶ç»“æœ</button>
      <button id="backPopupBtn" style="flex: 1; padding: 12px; background: #6c757d; color: white; border: none; border-radius: 30px; cursor: pointer;">è¿”å›æ¸…ç©º</button>
    </div>
  </div>
</div>
<!-- æ ¡éªŒç•Œé¢ -->
<div class="checking-container" id="checkingContainer">
  <div class="checking-text">æ­£åœ¨æ ¡éªŒä¸­</div>
  <div class="spinner"></div>
</div>

    <!-- éªŒè¯åŠ¨ç”» -->
    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
        <path d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
    </svg>

    <svg class="crossmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
        <path d="M16 16l20 20 M36 16l-20 20"/>
    </svg>

    <!-- å¯†ç éªŒè¯ç•Œé¢ -->
    <div class="auth-container" id="authContainer">
        <div class="auth-header">
            <h1>å®‰å…¨éªŒè¯</h1>
            <p>è¯·è¾“å…¥å¯†ç è¿›å…¥</p>
        </div>
        <div class="auth-body">
            <div class="auth-title">è¾“å…¥è®¿é—®å¯†ç </div>
            <div class="password-display" id="passwordDisplay"></div>
            <div class="numpad">
                <button class="num-btn" data-number="1">1</button>
                <button class="num-btn" data-number="2">2</button>
                <button class="num-btn" data-number="3">3</button>
                <button class="num-btn" data-number="4">4</button>
                <button class="num-btn" data-number="5">5</button>
                <button class="num-btn" data-number="6">6</button>
                <button class="num-btn" data-number="7">7</button>
                <button class="num-btn" data-number="8">8</button>
                <button class="num-btn" data-number="9">9</button>
                <button class="num-btn empty"></button>
                <button class="num-btn" data-number="0">0</button>
                <button class="num-btn" id="backspaceBtn">âŒ«</button>
                <button class="submit-btn" id="submitAuthBtn">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div class="container" id="mainContainer" style="display:none;">
        <div class="header">
            <h1>NR-AES</h1>
            <p>æ–‡æœ¬æ•°æ®åŠ å¯†ï¼Œä¿è¯æ‚¨çš„æ•°æ®å®‰å…¨ï¼ˆNEVERRESTSTUDIOï¼‰</p>
            <button class="recovery-btn" id="recoveryBtn">å†å²è®°å½•</button>
        </div>

        <div class="content">
            <div class="tabs">
                <div class="tab active" data-tab="encrypt">åŠ å¯†</div>
                <div class="tab" data-tab="decrypt">è§£å¯†</div>
            </div>

            <div id="alertBox"></div>

            <div id="encrypt" class="tab-content active">
                <div class="form-group">
                    <label>åŠ å¯†å±‚æ•°</label>
                    <div class="layer-controls">
                        <button class="layer-btn" id="decreaseLayer">-</button>
                        <div class="layer-display" id="layerDisplay">1</div>
                        <button class="layer-btn" id="increaseLayer">+</button>
                    </div>
                </div>

                <div id="encryptPasswordContainer" class="layer-inputs">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„å¯†ç è¾“å…¥æ¡†ä¼šæ”¾åœ¨è¿™é‡Œ -->
                </div>

                <div class="form-group">
                    <label for="encryptText">è¦åŠ å¯†çš„å†…å®¹</label>
                    <textarea id="encryptText" placeholder="è¾“å…¥æ‚¨è¦åŠ å¯†çš„æ–‡æœ¬..."></textarea>
                </div>

                <button id="encryptBtn" class="btn btn-block">
                    <i></i> åŠ å¯†
                </button>

                <div id="encryptResult" class="result-container" style="display:none;">
                    <h3>åŠ å¯†ç»“æœ</h3>
                    <button class="copy-btn" onclick="copyToClipboard('encryptedOutput')">ğŸ“‹</button>
                    <div id="encryptedOutput"></div>
                </div>
            </div>

            <div id="decrypt" class="tab-content">
                <div class="form-group">
                    <label>è¯·é€‰æ‹©è§£å¯†å±‚æ•°</label>
                    <div class="layer-controls">
                        <button class="layer-btn" id="decreaseDecryptLayer">-</button>
                        <div class="layer-display" id="decryptLayerDisplay">1</div>
                        <button class="layer-btn" id="increaseDecryptLayer">+</button>
                    </div>
                </div>

                <div id="decryptPasswordContainer" class="layer-inputs">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„å¯†ç è¾“å…¥æ¡†ä¼šæ”¾åœ¨è¿™é‡Œ -->
                </div>

                <div class="form-group">
                    <label for="decryptText">è¦è§£å¯†çš„å†…å®¹</label>
                    <textarea id="decryptText" placeholder="è¾“å…¥æ‚¨è¦è§£å¯†çš„æ–‡æœ¬..."></textarea>
                </div>

                <button id="decryptBtn" class="btn btn-block">
                    <i></i> è§£å¯†
                </button>

                <div id="decryptResult" class="result-container" style="display:none;">
                    <h3>è§£å¯†ç»“æœ</h3>
                    <button class="copy-btn" onclick="copyToClipboard('decryptedOutput')">ğŸ“‹</button>
                    <div id="decryptedOutput"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- é”™è¯¯ç•Œé¢ -->
    <div class="error-container" id="errorContainer">
        <svg class="error-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
            <path d="M16 16l20 20 M36 16l-20 20"/>
        </svg>
        <div class="error-message">å®‰å…¨ç³»ç»Ÿï¼šæ£€æµ‹åˆ°è¾“å…¥è¿‡é”™è¯¯çš„å¯†ç ï¼Œå·²æ‹¦æˆªé”™è¯¯è¯·æ±‚</div>
        <button class="back-btn" id="backBtn">ç»§ç»­</button>
    </div>

    <!-- é”å®šç•Œé¢ -->
    <div class="lock-container" id="lockContainer">
        <div class="lock-icon">ğŸ”’</div>
        <div class="lock-message">å¯†ç è¾“å…¥é”™è¯¯æ¬¡æ•°è¿‡å¤š</div>
        <div class="lock-message">ç³»ç»Ÿå·²é”å®š</div>
        <div class="lock-timer" id="lockTimer">1:00</div>
    </div>

    <!-- æ‰¾å›æ•°æ®ç•Œé¢ -->
<div class="recovery-container" id="recoveryContainer">
    <div class="recovery-box">
        <div class="recovery-header">
            <h2></h2>
            <button class="clear-history-btn" id="clearHistoryBtn">æ¸…é™¤è®°å½•</button>
            <button class="close-recovery" id="closeRecoveryBtn">Ã—</button>
        </div>
        
        <!-- å†å²è®°å½•åˆ—è¡¨ï¼ˆå¸¦æ»šåŠ¨æ¡ï¼‰ -->
        <div class="history-list" style="max-height: 70vh; overflow-y: auto; padding: 15px;">
            <!-- è¿™é‡Œä¼šè‡ªåŠ¨ç”Ÿæˆå°æ¡† -->
        </div>
        
        <!-- æ¸…é™¤æŒ‰é’®å·²åœ¨headeré‡Œï¼Œè¿™é‡Œä¸ç”¨é‡å¤ -->
        <!-- è¯¦æƒ…å¼¹çª—ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <div class="history-detail" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center;">
            <div style="background: white; width: 90%; max-width: 500px; border-radius: 12px; padding: 20px; max-height: 80vh; overflow-y: auto;">
                <!-- è¯¦æƒ…æ ‡é¢˜ï¼ˆè“è‰²ï¼‰ -->
                <div style="color: #4361ee; font-size: 18px; font-weight: bold; margin-bottom: 20px;">è®°å½• #<span id="detailId"></span></div>
                
                <!-- è¯¦æƒ…å†…å®¹ï¼ˆé»‘è‰²ï¼‰ -->
                <div style="color: #333; line-height: 1.6;">
                    <div style="margin-bottom: 15px;"><strong>æ—¶é—´ï¼š</strong><span id="detailTime"></span></div>
                    <div style="margin-bottom: 15px;"><strong>åŠ å¯†å±‚æ•°ï¼š</strong><span id="detailLayers"></span></div>
                    <div style="margin-bottom: 15px;">
                        <strong>åŸå§‹å†…å®¹ï¼š</strong><br>
                        <div style="margin-top: 5px; padding: 10px; background: #f5f5f5; border-radius: 6px; white-space: pre-wrap;" id="detailOriginal"></div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>åŠ å¯†ç»“æœï¼š</strong><br>
                        <div style="margin-top: 5px; padding: 10px; background: #f5f5f5; border-radius: 6px; white-space: pre-wrap;" id="detailEncrypted"></div>
                    </div>
                </div>
                
                <!-- è¿”å›æŒ‰é’® -->
                <div style="margin-top: 20px; text-align: center;">
                    <button id="backFromDetailBtn" style="padding: 10px 20px; background: #4361ee; color: white; border: none; border-radius: 30px; cursor: pointer;">è¿”å›åˆ—è¡¨</button>
                </div>
            </div>
        </div>
    </div>
</div>


    <script>
    // å…ˆè·å–æ ¡éªŒç•Œé¢çš„å…ƒç´ 
const checkingContainer = document.getElementById('checkingContainer');

// 1. ä»é“¾æ¥è·å–å†…å®¹
fetch('https://neverrest-studio.github.io/neverrestaesencryption-jc.html')
  .then(response => response.text()) // è¯»å–æ–‡æœ¬å†…å®¹
  .then(text => {
    // 2. ç­‰å¾…1ç§’é’Ÿï¼ˆè®©åœ†åœˆè½¬å¤Ÿ1ç§’ï¼‰
    setTimeout(() => {
      if (text.trim() === 'è¡Œ') {
        // 3. å¦‚æœæ˜¯"è¡Œ"ï¼Œå°±éšè—æ ¡éªŒç•Œé¢ï¼Œè¿›å…¥æ­£å¸¸é¡µé¢
        checkingContainer.style.display = 'none';
      } else if (text.trim() === 'åœ') {
        // 4. å¦‚æœæ˜¯"åœ"ï¼Œå°±æ˜¾ç¤º"æ ¡éªŒä¸é€šè¿‡"
        checkingContainer.innerHTML = '<div class="failed-check">æ ¡éªŒä¸é€šè¿‡ï¼Œè¯·ç¨åå†è¯•ï¼</div>';
      }
    }, 1000); // è¿™é‡Œçš„1000å°±æ˜¯1ç§’
  });

        const passwordUrl = "https://neverrest-studio.github.io/neverrestaesencryption-hd.html";
        
        // å…¨å±€å˜é‡
        let authPassword = '';
        let currentPassword = '';
        let isAuthenticated = false;
        let failedAttempts = 0;
        let lockUntil = 0;
        let storedData = JSON.parse(localStorage.getItem('secureAESData')) || [];
        let isRecoveryMode = false;

        // DOMå…ƒç´ 
        const authContainer = document.getElementById('authContainer');
        const passwordDisplay = document.getElementById('passwordDisplay');
        const numpadBtns = document.querySelectorAll('.num-btn[data-number]');
        const backspaceBtn = document.getElementById('backspaceBtn');
        const submitAuthBtn = document.getElementById('submitAuthBtn');
        const mainContainer = document.getElementById('mainContainer');
        const checkmark = document.querySelector('.checkmark');
        const crossmark = document.querySelector('.crossmark');
        const errorContainer = document.getElementById('errorContainer');
        const backBtn = document.getElementById('backBtn');
        const lockContainer = document.getElementById('lockContainer');
        const lockTimer = document.getElementById('lockTimer');
        const recoveryBtn = document.getElementById('recoveryBtn');
        const recoveryContainer = document.getElementById('recoveryContainer');
        const closeRecoveryBtn = document.getElementById('closeRecoveryBtn');
        const recoveryBody = document.getElementById('recoveryBody');

        // åˆå§‹åŒ–
        async function init() {
            // æ£€æŸ¥æ˜¯å¦è¢«é”å®š
            checkLockStatus();
            
            // è·å–è¿œç¨‹å¯†ç 
            await fetchRemotePassword();
            
            // æ•°å­—æŒ‰é’®äº‹ä»¶
            numpadBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    if (authPassword.length < 6) {
                        authPassword += btn.dataset.number;
                        updatePasswordDisplay();
                    }
                });
            });
            
            // é€€æ ¼æŒ‰é’®
            backspaceBtn.addEventListener('click', () => {
                authPassword = authPassword.slice(0, -1);
                updatePasswordDisplay();
            });
            
            // æäº¤æŒ‰é’®
            submitAuthBtn.addEventListener('click', checkAuthPassword);
            
            // è¿”å›æŒ‰é’®
            backBtn.addEventListener('click', () => {
                errorContainer.classList.remove('active');
                authPassword = '';
                updatePasswordDisplay();
            });
            
            // æ‰¾å›æ•°æ®æŒ‰é’®
            recoveryBtn.addEventListener('click', () => {
                isRecoveryMode = true;
                authContainer.style.display = 'flex';
                mainContainer.style.display = 'none';
                authPassword = '';
                updatePasswordDisplay();
            });
            
            closeRecoveryBtn.addEventListener('click', closeRecovery);
            
            // åˆå§‹åŒ–ä¸»ç•Œé¢
            initMainInterface();
        }

        // æ£€æŸ¥é”å®šçŠ¶æ€
        function checkLockStatus() {
            const now = Date.now();
            const lockTime = localStorage.getItem('lockTime');
            failedAttempts = parseInt(localStorage.getItem('failedAttempts')) || 0;
            
            if (lockTime && now < parseInt(lockTime)) {
                lockUntil = parseInt(lockTime);
                startLockTimer();
                return;
            }
            
            // æ¸…é™¤é”å®šçŠ¶æ€
            if (lockTime) {
                localStorage.removeItem('lockTime');
                failedAttempts = 0;
                lockUntil = 0;
            }
        }

        // å¼€å§‹é”å®šè®¡æ—¶å™¨
        function startLockTimer() {
            authContainer.style.display = 'none';
            lockContainer.classList.add('active');
            
            const updateTimer = () => {
                const now = Date.now();
                const remaining = Math.max(0, lockUntil - now);
                
                if (remaining <= 0) {
                    lockContainer.classList.remove('active');
                    authContainer.style.display = 'flex';
                    localStorage.removeItem('lockTime');
                    localStorage.removeItem('failedAttempts');
                    failedAttempts = 0;
                    lockUntil = 0;
                    return;
                }
                
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                lockTimer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                setTimeout(updateTimer, 1000);
            };
            
            updateTimer();
        }

        // æ›´æ–°å¯†ç æ˜¾ç¤º
        function updatePasswordDisplay() {
            passwordDisplay.textContent = '*'.repeat(authPassword.length);
            passwordDisplay.classList.toggle('active', authPassword.length > 0);
        }

        // è·å–è¿œç¨‹å¯†ç 
        async function fetchRemotePassword() {
            try {
                const response = await fetch(passwordUrl);
                if (!response.ok) throw new Error('Network error');
                const text = await response.text();
                
                // éªŒè¯æ˜¯å¦ä¸º6ä½æ•°å­—
                if (/^\d{6}$/.test(text)) {
                    currentPassword = text;
                } else {
                    throw new Error('æœåŠ¡å™¨å·²è¢«å…³é—­');
                }
            } catch (error) {
                console.error('æœåŠ¡å™¨å·²è¢«å…³é—­:', error);
                showAlert('æ— æ³•è¿æ¥æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
            }
        }

        // æ£€æŸ¥è®¤è¯å¯†ç 
        function checkAuthPassword() {
            if (authPassword.length !== 6) {
                showAuthFeedback(false);
                return;
            }
            
            if (authPassword === currentPassword) {
                showAuthFeedback(true, () => {
                    if (isRecoveryMode) {
                        // æ‰¾å›æ•°æ®æ¨¡å¼
                        isRecoveryMode = false;
                        authContainer.style.display = 'none';
                        recoveryContainer.classList.add('active');
                        renderRecoveryData();
                    } else {
                        // æ­£å¸¸ç™»å½•æ¨¡å¼
                        authContainer.style.display = 'none';
                        mainContainer.style.display = '';
                        isAuthenticated = true;
                    }
                    
                    // é‡ç½®å¤±è´¥å°è¯•
                    failedAttempts = 0;
                    localStorage.removeItem('failedAttempts');
                });
            } else {
                failedAttempts++;
                localStorage.setItem('failedAttempts', failedAttempts);
                
                if (failedAttempts >= 5) {
                    // é”å®šç³»ç»Ÿ1åˆ†é’Ÿ
                    lockUntil = Date.now() + 1 * 60 * 1000;
                    localStorage.setItem('lockTime', lockUntil.toString());
                    startLockTimer();
                } else {
                    showAuthFeedback(false, () => {
                        errorContainer.classList.add('active');
                    });
                }
            }
        }

        // æ˜¾ç¤ºè®¤è¯åé¦ˆ
        function showAuthFeedback(success, callback) {
            const mark = success ? checkmark : crossmark;
            
            // é‡ç½®åŠ¨ç”»
            mark.querySelector('path').style.strokeDashoffset = '1000';
            mark.querySelector('path').style.animation = 'none';
            void mark.querySelector('path').offsetWidth; // è§¦å‘é‡ç»˜
            
            // æ˜¾ç¤ºå¹¶è¿è¡ŒåŠ¨ç”»
            mark.style.opacity = '1';
            mark.querySelector('path').style.animation = 'draw 0.8s ease forwards';
            
            setTimeout(() => {
                mark.style.opacity = '0';
                if (callback) callback();
            }, 1000);
        }

        // åˆå§‹åŒ–ä¸»ç•Œé¢
        function initMainInterface() {
            // åŠ å¯†å±‚æ•°æ§åˆ¶
            const layerDisplay = document.getElementById('layerDisplay');
            const decreaseLayer = document.getElementById('decreaseLayer');
            const increaseLayer = document.getElementById('increaseLayer');
            
            let layers = 1;
            
            decreaseLayer.addEventListener('click', () => {
                if (layers > 1) {
                    layers--;
                    layerDisplay.textContent = layers;
                    updateEncryptPasswordInputs(layers);
                }
            });
            
            increaseLayer.addEventListener('click', () => {
                if (layers < 10) {
                    layers++;
                    layerDisplay.textContent = layers;
                    updateEncryptPasswordInputs(layers);
                }
            });
            
            // è§£å¯†å¯†å±‚æ•°æ§åˆ¶
            const decryptLayerDisplay = document.getElementById('decryptLayerDisplay');
            const decreaseDecryptLayer = document.getElementById('decreaseDecryptLayer');
            const increaseDecryptLayer = document.getElementById('increaseDecryptLayer');
            
            let decryptLayers = 1;
            
            decreaseDecryptLayer.addEventListener('click', () => {
                if (decryptLayers > 1) {
                    decryptLayers--;
                    decryptLayerDisplay.textContent = decryptLayers;
                    updateDecryptPasswordInputs(decryptLayers);
                }
            });
            
            increaseDecryptLayer.addEventListener('click', () => {
                if (decryptLayers < 10) {
                    decryptLayers++;
                    decryptLayerDisplay.textContent = decryptLayers;
                    updateDecryptPasswordInputs(decryptLayers);
                }
            });
            
            // åˆå§‹åŒ–å¯†ç è¾“å…¥æ¡†
            updateEncryptPasswordInputs(layers);
            updateDecryptPasswordInputs(decryptLayers);
            
            // æ ‡ç­¾é¡µåˆ‡æ¢
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });
            
            // åŠ å¯†æŒ‰é’®
            document.getElementById('encryptBtn').addEventListener('click', function() {
  const text = document.getElementById('encryptText').value;
  const layers = parseInt(document.getElementById('layerDisplay').textContent);
  
  if (!text) {
    showAlert('è¯·è¾“å…¥è¦åŠ å¯†çš„å†…å®¹', 'error');
    return;
  }
  
  try {
    const passwords = getEncryptPasswords(layers);
    const encrypted = multiLayerEncrypt(text, passwords);
    
    // æ˜¾ç¤ºå¼¹çª—ï¼Œå¡«å……ç»“æœ
    document.getElementById('popupResultContent').textContent = encrypted;
    document.getElementById('resultPopup').style.display = 'flex'; // æ˜¾ç¤ºå¼¹çª—
    
    // ä¿å­˜è®°å½•ï¼ˆåŸæ¥çš„åŠŸèƒ½ä¿ç•™ï¼‰
    const record = {
      id: Date.now(),
      timestamp: new Date().toLocaleString(),
      layers: layers,
      passwords: passwords,
      originalText: text,
      encryptedText: encrypted
    };
    storedData.unshift(record);
    if (storedData.length > 20) storedData.pop();
    localStorage.setItem('secureAESData', JSON.stringify(storedData));
    
    showAlert(`æˆåŠŸåº”ç”¨ ${layers} å±‚åŠ å¯†ï¼`);
  } catch (error) {
    showAlert('åŠ å¯†å¤±è´¥: ' + error.message, 'error');
    console.error(error);
  }
});

            
            // è§£å¯†æŒ‰é’®
            document.getElementById('decryptBtn').addEventListener('click', function() {
  const text = document.getElementById('decryptText').value;
  const layers = parseInt(document.getElementById('decryptLayerDisplay').textContent);
  
  if (!text) {
    showAlert('è¯·è¾“å…¥è¦è§£å¯†çš„å†…å®¹', 'error');
    return;
  }
  
  try {
    const passwords = getDecryptPasswords(layers);
    const decrypted = multiLayerDecrypt(text, passwords);
    
    // æ˜¾ç¤ºå¼¹çª—ï¼Œå¡«å……ç»“æœ
    document.getElementById('popupResultContent').textContent = decrypted;
    document.getElementById('resultPopup').style.display = 'flex'; // æ˜¾ç¤ºå¼¹çª—
    
    showAlert(`æˆåŠŸè§£å¯† ${layers} å±‚åŠ å¯†ï¼`);
  } catch (error) {
    showAlert('è§£å¯†å¤±è´¥: ' + error.message, 'error');
    console.error(error);
  }
});

        }

        // æ›´æ–°åŠ å¯†å¯†ç è¾“å…¥æ¡†
        function updateEncryptPasswordInputs(layers) {
            const container = document.getElementById('encryptPasswordContainer');
            container.innerHTML = '';
            
            for (let i = 1; i <= layers; i++) {
                const div = document.createElement('div');
                div.className = 'layer-password';
                
                const label = document.createElement('label');
                label.textContent = `ç¬¬ ${i} å±‚å¯†ç :`;
                label.htmlFor = `encryptPassword${i}`;
                
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `encryptPassword${i}`;
                input.placeholder = `è¾“å…¥ç¬¬ ${i} å±‚å¯†ç `;
                
                div.appendChild(label);
                div.appendChild(input);
                container.appendChild(div);
            }
        }

        // æ›´æ–°è§£å¯†ç è¾“å…¥æ¡†
        function updateDecryptPasswordInputs(layers) {
            const container = document.getElementById('decryptPasswordContainer');
            container.innerHTML = '';
            
            for (let i = 1; i <= layers; i++) {
                const div = document.createElement('div');
                div.className = 'layer-password';
                
                const label = document.createElement('label');
                label.textContent = `ç¬¬ ${i} å±‚å¯†ç :`;
                label.htmlFor = `decryptPassword${i}`;
                
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `decryptPassword${i}`;
                input.placeholder = `è¾“å…¥ç¬¬ ${i} å±‚å¯†ç `;
                
                div.appendChild(label);
                div.appendChild(input);
                container.appendChild(div);
            }
        }

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showAlert(message, type = 'success') {
            const alertBox = document.getElementById('alertBox');
            alertBox.className = `alert alert-${type}`;
            alertBox.textContent = message;
            alertBox.style.display = 'block';
            
            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 5000);
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const range = document.createRange();
            range.selectNode(element);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
            
            showAlert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
        }

        // å¤šå±‚åŠ å¯†å‡½æ•°
        function multiLayerEncrypt(text, passwords) {
            let encrypted = text;
            for (const password of passwords) {
                encrypted = CryptoJS.AES.encrypt(encrypted, password).toString();
            }
            return encrypted;
        }

        // å¤šå±‚è§£å¯†å‡½æ•°
        function multiLayerDecrypt(text, passwords) {
            let decrypted = text;
            // éœ€è¦åå‘è§£å¯†ï¼Œä»æœ€åä¸€å±‚å¼€å§‹
            for (let i = passwords.length - 1; i >= 0; i--) {
                const bytes = CryptoJS.AES.decrypt(decrypted, passwords[i]);
                decrypted = bytes.toString(CryptoJS.enc.Utf8);
                
                if (!decrypted) {
                    throw new Error(`ç¬¬ ${passwords.length - i} å±‚è§£å¯†å¤±è´¥ï¼Œå¯†ç å¯èƒ½é”™è¯¯`);
                }
            }
            return decrypted;
        }

        // è·å–æ‰€æœ‰åŠ å¯†å¯†ç 
        function getEncryptPasswords(layers) {
            const passwords = [];
            
            for (let i = 1; i <= layers; i++) {
                const password = document.getElementById(`encryptPassword${i}`).value;
                if (!password) {
                    throw new Error(`è¯·è¾“å…¥ç¬¬ ${i} å±‚å¯†ç `);
                }
                passwords.push(password);
            }
            
            return passwords;
        }

        // è·å–æ‰€æœ‰è§£å¯†å¯†ç 
        function getDecryptPasswords(layers) {
            const passwords = [];
            
            for (let i = 1; i <= layers; i++) {
                const password = document.getElementById(`decryptPassword${i}`).value;
                if (!password) {
                    throw new Error(`è¯·è¾“å…¥ç¬¬ ${i} å±‚å¯†ç `);
                }
                passwords.push(password);
            }
            
            return passwords;
        }

        // åŠ å¯†æ•°æ®
        function encryptData() {
            const text = document.getElementById('encryptText').value;
            const layers = parseInt(document.getElementById('layerDisplay').textContent);
            
            if (!text) {
                showAlert('è¯·è¾“å…¥è¦åŠ å¯†çš„å†…å®¹', 'error');
                return;
            }
            
            try {
                const passwords = getEncryptPasswords(layers);
                const encrypted = multiLayerEncrypt(text, passwords);
                
                // ä¿å­˜è®°å½•
                const record = {
                    id: Date.now(),
                    timestamp: new Date().toLocaleString(),
                    layers: layers,
                    passwords: passwords,
                    originalText: text,
                    encryptedText: encrypted
                };
                
                storedData.unshift(record); // æ·»åŠ åˆ°å¼€å¤´
                if (storedData.length > 20) storedData.pop(); // é™åˆ¶è®°å½•æ•°é‡
                localStorage.setItem('secureAESData', JSON.stringify(storedData));
                
                // æ˜¾ç¤ºç»“æœ
                document.getElementById('encryptedOutput').textContent = encrypted;
                document.getElementById('encryptResult').style.display = 'block';
                showAlert(`æˆåŠŸåº”ç”¨ ${layers} å±‚åŠ å¯†ï¼`);
            } catch (error) {
                showAlert('åŠ å¯†å¤±è´¥: ' + error.message, 'error');
                console.error(error);
            }
        }

        // è§£å¯†æ•°æ®
        function decryptData() {
            const text = document.getElementById('decryptText').value;
            const layers = parseInt(document.getElementById('decryptLayerDisplay').textContent);
            
            if (!text) {
                showAlert('è¯·è¾“å…¥è¦è§£å¯†çš„å†…å®¹', 'error');
                return;
            }
            
            try {
                const passwords = getDecryptPasswords(layers);
                const decrypted = multiLayerDecrypt(text, passwords);
                
                document.getElementById('decryptedOutput').textContent = decrypted;
                document.getElementById('decryptResult').style.display = 'block';
                showAlert(`æˆåŠŸè§£å¯† ${layers} å±‚åŠ å¯†ï¼`);
            } catch (error) {
                showAlert('è§£å¯†å¤±è´¥: ' + error.message, 'error');
                console.error(error);
            }
        }

        // å…³é—­æ‰¾å›æ•°æ®ç•Œé¢
        function closeRecovery() {
            recoveryContainer.classList.remove('active');
            authContainer.style.display = 'none';
            mainContainer.style.display = '';
        }

// æ¸²æŸ“å†å²è®°å½•åˆ—è¡¨ï¼ˆæ˜¾ç¤ºå°æ¡†ï¼‰
function renderRecoveryData() {
    // æ‰¾åˆ°æ”¾å°æ¡†çš„å®¹å™¨ï¼ˆæ–°åˆ—è¡¨å®¹å™¨ï¼‰
    const historyList = document.querySelector('.history-list');
    historyList.innerHTML = ''; // å…ˆæ¸…ç©ºå®¹å™¨
    
    // å¦‚æœæ²¡æœ‰è®°å½•ï¼Œæ˜¾ç¤ºâ€œæš‚æ— å†å²è®°å½•â€
    if (storedData.length === 0) {
        historyList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">æš‚æ— å†å²è®°å½•</div>';
        return;
    }
    
    // éå†æ‰€æœ‰è®°å½•ï¼Œç”Ÿæˆå°æ¡†
    storedData.forEach((record, index) => {
        // åˆ›å»ºä¸€ä¸ªå°æ¡†
        const item = document.createElement('div');
        item.className = 'history-item'; // ç”¨ä¸Šé¢åŠ çš„CSSæ ·å¼
        
        // å–åŸå§‹å†…å®¹å‰6ä¸ªå­—ï¼Œè¶…è¿‡å°±åŠ ...
        let previewText = record.originalText || 'æ— å†…å®¹'; // å¦‚æœæ²¡æœ‰å†…å®¹ï¼Œæ˜¾ç¤ºâ€œæ— å†…å®¹â€
        if (previewText.length > 6) {
            previewText = previewText.substring(0, 6) + '...'; // æˆªå–å‰6ä¸ªå­—
        }
        
        // å°æ¡†é‡Œçš„å†…å®¹ï¼šå·¦è¾¹æ˜¾ç¤ºé¢„è§ˆæ–‡å­—ï¼Œå³è¾¹æ˜¾ç¤ºâ€œæŸ¥çœ‹â€æŒ‰é’®
        item.innerHTML = `
            <div class="content-preview">${previewText}</div>
            <button class="view-btn" data-index="${index}">æŸ¥çœ‹</button>
        `;
        
        // æŠŠå°æ¡†æ”¾åˆ°åˆ—è¡¨é‡Œ
        historyList.appendChild(item);
    });
    
    // ç»™æ‰€æœ‰â€œæŸ¥çœ‹â€æŒ‰é’®åŠ ç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const index = this.getAttribute('data-index'); // æ‹¿åˆ°ç‚¹å‡»çš„æ˜¯ç¬¬å‡ ä¸ªè®°å½•
            showDetail(index); // è°ƒç”¨æ˜¾ç¤ºè¯¦æƒ…çš„å‡½æ•°
        });
    });
}

// æ˜¾ç¤ºè¯¦æƒ…é¡µ
function showDetail(index) {
    const record = storedData[index]; // æ‹¿åˆ°å¯¹åº”çš„è®°å½•æ•°æ®
    if (!record) return; // å¦‚æœæ²¡æ•°æ®ï¼Œä¸æ‰§è¡Œ
    
    // ç»™è¯¦æƒ…é¡µçš„å ä½ç¬¦å¡«å†…å®¹
    document.getElementById('detailId').textContent = record.id; // è®°å½•ID
    document.getElementById('detailTime').textContent = record.timestamp; // æ—¶é—´
    document.getElementById('detailLayers').textContent = record.layers; // åŠ å¯†å±‚æ•°
    document.getElementById('detailOriginal').textContent = record.originalText || 'æ— '; // åŸå§‹å†…å®¹
    document.getElementById('detailEncrypted').textContent = record.encryptedText || 'æ— '; // åŠ å¯†ç»“æœ
    
    // æ˜¾ç¤ºè¯¦æƒ…é¡µï¼ˆæŠŠdisplay: noneæ”¹æˆflexï¼‰
    document.querySelector('.history-detail').style.display = 'flex';
}

// ç»™â€œè¿”å›åˆ—è¡¨â€æŒ‰é’®åŠ äº‹ä»¶ï¼ˆå…³é—­è¯¦æƒ…é¡µï¼‰
document.getElementById('backFromDetailBtn').addEventListener('click', function() {
    document.querySelector('.history-detail').style.display = 'none';
});


        // åŠ è½½æ‰¾å›çš„æ•°æ®é¡¹
        function loadRecoveryItem(id) {
            const item = storedData.find(d => d.id === id);
            if (!item) return;
            
            // åˆ‡æ¢åˆ°åŠ å¯†æ ‡ç­¾é¡µ
            document.querySelector('.tab[data-tab="encrypt"]').click();
            
            // è®¾ç½®å±‚æ•°
            document.getElementById('layerDisplay').textContent = item.layers;
            updateEncryptPasswordInputs(item.layers);
            
            // å¡«å……å¯†ç 
            for (let i = 0; i < item.layers; i++) {
                document.getElementById(`encryptPassword${i+1}`).value = item.passwords[i];
            }
            
            // å¡«å……å†…å®¹
            document.getElementById('encryptText').value = item.originalText;
            
            // å…³é—­æ‰¾å›ç•Œé¢
            closeRecovery();
            
            showAlert('å·²åŠ è½½å†å²è®°å½•');
        }

        // æš´éœ²ç»™å…¨å±€çš„æ–¹æ³•
        window.loadRecoveryItem = loadRecoveryItem;
        window.copyToClipboard = copyToClipboard;

        // åˆå§‹åŒ–åº”ç”¨
        init();
    // å¼¹çª—å¤åˆ¶æŒ‰é’®åŠŸèƒ½
document.getElementById('copyPopupBtn').addEventListener('click', function() {
  const resultText = document.getElementById('popupResultContent').textContent;
  navigator.clipboard.writeText(resultText).then(function() {
    showAlert('ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
  });
});

// å¼¹çª—è¿”å›æŒ‰é’®åŠŸèƒ½ï¼ˆæ¸…ç©ºæ‰€æœ‰è¾“å…¥ï¼Œå…³é—­å¼¹çª—ï¼‰
document.getElementById('backPopupBtn').addEventListener('click', function() {
  // æ¸…ç©ºåŠ å¯†ç›¸å…³è¾“å…¥
  document.getElementById('encryptText').value = '';
  document.getElementById('encryptResult').style.display = 'none';
  // æ¸…ç©ºè§£å¯†ç›¸å…³è¾“å…¥
  document.getElementById('decryptText').value = '';
  document.getElementById('decryptResult').style.display = 'none';
  // æ¸…ç©ºæ‰€æœ‰å¯†ç æ¡†
  document.querySelectorAll('#encryptPasswordContainer input, #decryptPasswordContainer input').forEach(input => {
    input.value = '';
  });
  // å…³é—­å¼¹çª—
  document.getElementById('resultPopup').style.display = 'none';
});
    // æ¸…é™¤å†å²è®°å½•æŒ‰é’®åŠŸèƒ½
document.getElementById('clearHistoryBtn').addEventListener('click', function() {
  // å¼¹å‡ºç¡®è®¤æ¡†ï¼Œé˜²æ­¢è¯¯ç‚¹
  if (confirm('ç¡®å®šè¦åˆ é™¤æ‰€æœ‰å†å²è®°å½•å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) {
    // æ¸…ç©ºæœ¬åœ°å­˜å‚¨çš„å†å²æ•°æ®
    storedData = [];
    localStorage.removeItem('secureAESData');
    // åˆ·æ–°å†å²è®°å½•ç•Œé¢ï¼ˆå˜æˆç©ºçš„ï¼‰
    renderRecoveryData();
    // æç¤ºåˆ é™¤æˆåŠŸ
    showAlert('æ‰€æœ‰å†å²è®°å½•å·²æ¸…é™¤');
  }
});
// é€šç”¨æ‰“å¼€å‡½æ•°ï¼šä¼ å®¹å™¨ ID
function openModal(modalId) {
  const modal = document.getElementById(modalId);
  modal.classList.add('show');
  modal.style.display = 'block';
}

// é€šç”¨å…³é—­å‡½æ•°ï¼šä¼ å®¹å™¨ ID
function closeModal(modalId) {
  const modal = document.getElementById(modalId);
  modal.classList.remove('show');
  setTimeout(() => {
    modal.style.display = 'none';
  }, 300); // ç­‰è¿‡æ¸¡ç»“æŸ
}

    </script>
</body>
</html>