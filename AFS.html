<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NR-AES</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3f37c9;
            --accent: #4895ef;
            --success: #4cc9f0;
            --error: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --radius: 16px;
            --shadow: 0 12px 24px rgba(0,0,0,0.1);
            --transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--dark);
            overflow: hidden;
        }

        /* 主容器 */
        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            position: relative;
        }

        /* 头部 */
        .header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 28px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        /* 内容区域 */
        .content {
            padding: 30px;
        }

        /* 标签页 */
        .tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid #e9ecef;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            position: relative;
            transition: var(--transition);
            color: #6c757d;
        }

        .tab.active {
            color: var(--primary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* 表单组 */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        input, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ced4da;
            border-radius: var(--radius);
            font-size: 15px;
            transition: var(--transition);
        }

        input:focus, textarea:focus {
            border-color: var(--accent);
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        /* 按钮 */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 500;
            font-size: 15px;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* 结果容器 */
        .result-container {
            margin-top: 25px;
            border: 1px solid #e9ecef;
            border-radius: var(--radius);
            padding: 15px;
            background: #f8f9fa;
            position: relative;
        }

        .result-container h3 {
            margin-bottom: 10px;
            font-size: 16px;
            color: var(--dark);
        }

        .copy-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--light);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .copy-btn:hover {
            background: #e9ecef;
        }

        /* 提示框 */
        .alert {
            padding: 12px 15px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .alert-success {
            background: rgba(76, 201, 240, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .alert-error {
            background: rgba(247, 37, 133, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }

        /* 层数控制 */
        .layer-controls {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .layer-btn {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: var(--light);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        /* 修复减号按钮不灵敏问题 */
        .layer-btn::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
        }

        .layer-btn:hover {
            background: #e9ecef;
        }

        .layer-btn.active {
            background: var(--primary);
            color: white;
        }

        .layer-display {
            font-size: 18px;
            font-weight: 500;
            min-width: 30px;
            text-align: center;
        }

        .layer-inputs {
            margin-top: 15px;
        }

        .layer-password {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .layer-password label {
            min-width: 100px;
            margin-bottom: 0;
            margin-right: 10px;
        }

        .layer-password input {
            flex: 1;
        }

        /* 找回数据按钮 */
        .recovery-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 13px;
            cursor: pointer;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }

        .recovery-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* 错误界面 */
        .error-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .error-container.active {
            opacity: 1;
            pointer-events: all;
        }

        .error-icon {
            width: 100px;
            height: 100px;
            margin-bottom: 30px;
        }

        .error-icon path {
            stroke-width: 6;
            stroke: var(--error);
            fill: none;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }

        .error-message {
            font-size: 22px;
            font-weight: 500;
            margin-bottom: 30px;
            color: var(--dark);
        }

        .back-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
        }

        .back-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .back-btn:active {
            transform: translateY(0);
        }

        /* 锁定界面 */
        .lock-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .lock-container.active {
            opacity: 1;
            pointer-events: all;
        }

        .lock-icon {
            font-size: 80px;
            color: var(--error);
            margin-bottom: 20px;
        }

        .lock-message {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 10px;
            text-align: center;
            color: var(--dark);
        }

        .lock-timer {
            font-size: 18px;
            color: var(--gray);
            margin-bottom: 30px;
        }

        /* 找回数据界面 */
        .recovery-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }

        .recovery-container.active {
            opacity: 1;
            pointer-events: all;
        }

        .recovery-box {
            background: white;
            border-radius: var(--radius);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            transform: translateY(20px);
            transition: var(--transition);
        }

        .recovery-container.active .recovery-box {
            transform: translateY(0);
        }

        .recovery-header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .recovery-header h2 {
            font-weight: 600;
            font-size: 22px;
        }

        .close-recovery {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .recovery-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .recovery-item {
            background: var(--light);
            border-radius: var(--radius);
            padding: 15px;
            margin-bottom: 15px;
        }

        .recovery-item h3 {
            margin-bottom: 10px;
            color: var(--primary);
            font-size: 16px;
        }

        .recovery-item p {
            margin-bottom: 8px;
            font-size: 14px;
        }

        .recovery-item .label {
            font-weight: 500;
            color: var(--dark);
            display: inline-block;
            min-width: 80px;
        }

        /* 密码验证界面 */
        .auth-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .auth-header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 28px;
            text-align: center;
            width: 100%;
            max-width: 400px;
        }

        .auth-header h1 {
            font-weight: 600;
            font-size: 26px;
            margin-bottom: 6px;
        }

        .auth-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .auth-body {
            padding: 30px;
            width: 100%;
            max-width: 400px;
        }

        .auth-title {
            text-align: center;
            margin-bottom: 24px;
            font-size: 18px;
            color: var(--dark);
        }

        .password-display {
            width: 100%;
            height: 60px;
            background: var(--light);
            border-radius: var(--radius);
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            letter-spacing: 4px;
            color: var(--dark);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .password-display::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
            transform: scaleX(0);
            transform-origin: left;
            transition: var(--transition);
        }

        .password-display.active::after {
            transform: scaleX(1);
        }

        .numpad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .num-btn {
            aspect-ratio: 1;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 22px;
            font-weight: 500;
            color: var(--dark);
            cursor: pointer;
            transition: var(--transition);
            user-select: none;
            position: relative;
        }

        /* 修复按钮点击区域 */
        .num-btn::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
        }

        .num-btn:hover {
            background: var(--light);
            transform: translateY(-2px);
        }

        .num-btn:active {
            transform: translateY(0);
            background: #e9ecef;
        }

        .num-btn.empty {
            visibility: hidden;
        }

        .submit-btn {
            grid-column: span 3;
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 30px;
            font-weight: 500;
            font-size: 16px;
            margin-top: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .submit-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        /* 验证动画 */
        .checkmark {
            width: 100px;
            height: 100px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            z-index: 210;
            pointer-events: none;
        }

        .checkmark path {
            stroke-width: 6;
            stroke: var(--success);
            fill: none;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }

        .crossmark {
            width: 100px;
            height: 100px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            z-index: 210;
            pointer-events: none;
        }

        .crossmark path {
            stroke-width: 6;
            stroke: var(--error);
            fill: none;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }

        @keyframes draw {
            to { stroke-dashoffset: 0; }
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                border-radius: 0;
                max-width: 100%;
                min-height: 100vh;
            }
            
            .content {
                padding: 20px;
            }
            
            .layer-password {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .layer-password label {
                margin-bottom: 5px;
            }
        }
        /* 校验界面样式 */
.checking-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: white;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999; /* 保证在最上层 */
}
.checking-text {
  font-size: 24px;
  color: #333;
  margin-bottom: 30px;
  font-weight: 500;
}
/* 旋转的蓝色圆圈 */
.spinner {
  width: 50px;
  height: 50px;
  border: 5px solid #e0e0e0; /* 浅灰边框 */
  border-top: 5px solid #4361ee; /* 蓝色顶部边框（旋转时会动） */
  border-radius: 50%; /* 圆形 */
  animation: spin 1s linear infinite; /* 旋转动画 */
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
/* 校验不通过的提示 */
.failed-check {
  font-size: 28px;
  color: #f72585; /* 红色 */
  text-align: center;
  padding: 0 20px;
}
/* 数字按钮：在白色背景上明显的毛玻璃 */
.num-btn {
  background: rgba(0, 0, 0, 0.1) !important; /* 深色半透明（在白色上明显） */
  backdrop-filter: blur(5px) !important; /* 加强模糊 */
  border: 1px solid rgba(0, 0, 0, 0.15) !important; /* 深色边框 */
  color: #333 !important; /* 深灰色数字（更清晰） */
  border-radius: 50% !important;
}
.num-btn:hover {
  background: rgba(0, 0, 0, 0.15) !important; /*  hover时深一点 */
}

/* 确认按钮：区分明显 */
.submit-btn {
  background: rgba(67, 97, 238, 0.25) !important; /* 蓝色加深 */
  backdrop-filter: blur(10px) !important;
  border: 1px solid rgba(67, 97, 238, 0.4) !important; /* 边框加深 */
  color: #fff !important;
}
/* 按钮点击回弹动画 */
.num-btn, .submit-btn {
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
}

/* 点击时缩小，松开后回弹 */
.num-btn:active, .submit-btn:active {
  transform: scale(0.85) !important;
}
/* 按钮基础阴影（常驻） */
.num-btn, .submit-btn {
  position: relative;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05) !important; /* 轻微阴影 */
  overflow: hidden !important; /* 让波纹不超出按钮 */
}

/* 波纹效果容器 */
.num-btn::after, .submit-btn::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  background: rgba(67, 97, 238, 0.1); /* 蓝色波纹 */
  border-radius: 50%;
  transform: translate(-50%, -50%);
  transition: width 0.6s ease-out, height 0.6s ease-out !important;
  pointer-events: none; /* 不影响点击 */
  z-index: 1; /* 波纹在按钮内部 */
}

/* 点击时触发波纹扩散 */
.num-btn:active::after, .submit-btn:active::after {
  width: 200px; /* 波纹最大宽度 */
  height: 200px; /* 波纹最大高度 */
  opacity: 0; /* 扩散后消失 */
}

/* 保持之前的回弹动画（如果需要保留） */
.num-btn, .submit-btn {
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
}
.num-btn:active, .submit-btn:active {
  transform: scale(0.85) !important;
}
.layer-inputs {
  max-height: 300px; /* 最多显示300像素高 */
  overflow-y: auto; /* 超过300像素就出现滚动条 */
  padding-right: 10px; /* 滚动条不挤内容 */
}
/* 清除历史记录按钮样式 */
.clear-history-btn {
  position: absolute; /* 让按钮在标题栏右侧 */
  top: 15px; /* 位置上下调整 */
  right: 60px; /* 离关闭按钮一点距离 */
  background: #f72585; /* 红色背景 */
  color: white; /* 白色文字 */
  border: none; /* 去掉边框 */
  padding: 6px 12px; /* 按钮大小 */
  border-radius: 30px; /* 圆角 */
  font-size: 13px; /* 文字大小 */
  cursor: pointer; /* 鼠标放上去变手型 */
  transition: background 0.3s; /* 点击时颜色变化更柔和 */
}
/* 鼠标放上去颜色变深一点 */
.clear-history-btn:hover {
  background: #d61a6f;
}
/* 历史记录小框样式 */
.history-item {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
}

.history-item:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.history-item .content-preview {
    color: #333;
    font-size: 15px;
    max-width: 70%; /* 防止文字太长 */
    white-space: nowrap; /* 不换行 */
    overflow: hidden; /* 超出隐藏 */
    text-overflow: ellipsis; /* 显示... */
}

.history-item .view-btn {
    background: #4361ee;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    cursor: pointer;
}
/* 所有弹窗的通用过渡 */
.modal {
  display: none; 
  opacity: 0; 
  transition: opacity 0.3s ease; 
  position: fixed;
  top: 0; 
  left: 0;
  width: 100%; 
  height: 100%;
  background: rgba(0,0,0,0.5);
}

/* 显示状态 */
.modal.show {
  display: block; 
  opacity: 1;
}
/* 按钮点击丝滑反馈（适配所有按钮） */
.btn, .num-btn, .layer-btn, .view-btn, .clear-history-btn, .back-btn, .submit-btn {
  /* 基础过渡：所有样式变化都丝滑过渡 */
  transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
  position: relative;
  overflow: hidden; /* 用于波纹效果 */
}

/* 点击时缩小（回弹前的压缩） */
.btn:active, .num-btn:active, .layer-btn:active, .view-btn:active, .clear-history-btn:active, .back-btn:active, .submit-btn:active {
  transform: scale(0.93); /* 轻微缩小 */
  box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* 阴影变浅 */
}

/* 按钮颜色加深（点击时更明显） */
.btn:active {
  background: #3652d8 !important; /* 主按钮点击时更深的蓝色 */
}
.num-btn:active {
  background: rgba(0,0,0,0.2) !important; /* 数字按钮点击时更深的灰色 */
}
.clear-history-btn:active {
  background: #c21564 !important; /* 红色按钮点击时更深的红色 */
}

/* 额外加个“波纹扩散”效果（点击时从中心散开一圈淡色） */
.btn::after, .num-btn::after, .layer-btn::after, .view-btn::after, .clear-history-btn::after, .back-btn::after, .submit-btn::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  background: rgba(255,255,255,0.3); /* 白色半透明波纹 */
  border-radius: 50%;
  transform: translate(-50%, -50%);
  transition: width 0.6s ease, height 0.6s ease;
  pointer-events: none; /* 不影响点击 */
}

/* 点击时触发波纹扩散 */
.btn:active::after, .num-btn:active::after, .layer-btn:active::after, .view-btn:active::after, .clear-history-btn:active::after, .back-btn:active::after, .submit-btn:active::after {
  width: 200px; /* 波纹最大宽度 */
  height: 200px; /* 波纹最大高度 */
  opacity: 0; /* 扩散后消失 */
}
input:focus, textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(72, 149, 239, 0.2); /* 新增：淡蓝色光晕扩散 */
  transition: all 0.3s ease; /* 让高亮慢慢出现 */
}



    </style>
</head>
<body>
<!-- 加密解密结果弹窗 -->
<div id="resultPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; justify-content: center; align-items: center;">
  <div style="background: white; width: 90%; max-width: 500px; padding: 25px; border-radius: 16px; box-shadow: 0 10px 20px rgba(0,0,0,0.2);">
    <h3 style="margin-bottom: 15px; color: #4361ee;">处理结果</h3>
    <div id="popupResultContent" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; min-height: 100px; word-break: break-all;"></div>
    <div style="display: flex; gap: 10px; margin-top: 20px;">
      <button id="copyPopupBtn" style="flex: 1; padding: 12px; background: #4361ee; color: white; border: none; border-radius: 30px; cursor: pointer;">复制结果</button>
      <button id="backPopupBtn" style="flex: 1; padding: 12px; background: #6c757d; color: white; border: none; border-radius: 30px; cursor: pointer;">返回清空</button>
    </div>
  </div>
</div>
<!-- 校验界面 -->
<div class="checking-container" id="checkingContainer">
  <div class="checking-text">正在校验中</div>
  <div class="spinner"></div>
</div>

    <!-- 验证动画 -->
    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
        <path d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
    </svg>

    <svg class="crossmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
        <path d="M16 16l20 20 M36 16l-20 20"/>
    </svg>

    <!-- 密码验证界面 -->
    <div class="auth-container" id="authContainer">
        <div class="auth-header">
            <h1>安全验证</h1>
            <p>请输入密码进入</p>
        </div>
        <div class="auth-body">
            <div class="auth-title">输入访问密码</div>
            <div class="password-display" id="passwordDisplay"></div>
            <div class="numpad">
                <button class="num-btn" data-number="1">1</button>
                <button class="num-btn" data-number="2">2</button>
                <button class="num-btn" data-number="3">3</button>
                <button class="num-btn" data-number="4">4</button>
                <button class="num-btn" data-number="5">5</button>
                <button class="num-btn" data-number="6">6</button>
                <button class="num-btn" data-number="7">7</button>
                <button class="num-btn" data-number="8">8</button>
                <button class="num-btn" data-number="9">9</button>
                <button class="num-btn empty"></button>
                <button class="num-btn" data-number="0">0</button>
                <button class="num-btn" id="backspaceBtn">⌫</button>
                <button class="submit-btn" id="submitAuthBtn">确认</button>
            </div>
        </div>
    </div>

    <!-- 主界面 -->
    <div class="container" id="mainContainer" style="display:none;">
        <div class="header">
            <h1>NR-AES</h1>
            <p>文本数据加密，保证您的数据安全（NEVERRESTSTUDIO）</p>
            <button class="recovery-btn" id="recoveryBtn">历史记录</button>
        </div>

        <div class="content">
            <div class="tabs">
                <div class="tab active" data-tab="encrypt">加密</div>
                <div class="tab" data-tab="decrypt">解密</div>
            </div>

            <div id="alertBox"></div>

            <div id="encrypt" class="tab-content active">
                <div class="form-group">
                    <label>加密层数</label>
                    <div class="layer-controls">
                        <button class="layer-btn" id="decreaseLayer">-</button>
                        <div class="layer-display" id="layerDisplay">1</div>
                        <button class="layer-btn" id="increaseLayer">+</button>
                    </div>
                </div>

                <div id="encryptPasswordContainer" class="layer-inputs">
                    <!-- 动态生成的密码输入框会放在这里 -->
                </div>

                <div class="form-group">
                    <label for="encryptText">要加密的内容</label>
                    <textarea id="encryptText" placeholder="输入您要加密的文本..."></textarea>
                </div>

                <button id="encryptBtn" class="btn btn-block">
                    <i></i> 加密
                </button>

                <div id="encryptResult" class="result-container" style="display:none;">
                    <h3>加密结果</h3>
                    <button class="copy-btn" onclick="copyToClipboard('encryptedOutput')">📋</button>
                    <div id="encryptedOutput"></div>
                </div>
            </div>

            <div id="decrypt" class="tab-content">
                <div class="form-group">
                    <label>请选择解密层数</label>
                    <div class="layer-controls">
                        <button class="layer-btn" id="decreaseDecryptLayer">-</button>
                        <div class="layer-display" id="decryptLayerDisplay">1</div>
                        <button class="layer-btn" id="increaseDecryptLayer">+</button>
                    </div>
                </div>

                <div id="decryptPasswordContainer" class="layer-inputs">
                    <!-- 动态生成的密码输入框会放在这里 -->
                </div>

                <div class="form-group">
                    <label for="decryptText">要解密的内容</label>
                    <textarea id="decryptText" placeholder="输入您要解密的文本..."></textarea>
                </div>

                <button id="decryptBtn" class="btn btn-block">
                    <i></i> 解密
                </button>

                <div id="decryptResult" class="result-container" style="display:none;">
                    <h3>解密结果</h3>
                    <button class="copy-btn" onclick="copyToClipboard('decryptedOutput')">📋</button>
                    <div id="decryptedOutput"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 错误界面 -->
    <div class="error-container" id="errorContainer">
        <svg class="error-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
            <path d="M16 16l20 20 M36 16l-20 20"/>
        </svg>
        <div class="error-message">安全系统：检测到输入过错误的密码，已拦截错误请求</div>
        <button class="back-btn" id="backBtn">继续</button>
    </div>

    <!-- 锁定界面 -->
    <div class="lock-container" id="lockContainer">
        <div class="lock-icon">🔒</div>
        <div class="lock-message">密码输入错误次数过多</div>
        <div class="lock-message">系统已锁定</div>
        <div class="lock-timer" id="lockTimer">1:00</div>
    </div>

    <!-- 找回数据界面 -->
<div class="recovery-container" id="recoveryContainer">
    <div class="recovery-box">
        <div class="recovery-header">
            <h2></h2>
            <button class="clear-history-btn" id="clearHistoryBtn">清除记录</button>
            <button class="close-recovery" id="closeRecoveryBtn">×</button>
        </div>
        
        <!-- 历史记录列表（带滚动条） -->
        <div class="history-list" style="max-height: 70vh; overflow-y: auto; padding: 15px;">
            <!-- 这里会自动生成小框 -->
        </div>
        
        <!-- 清除按钮已在header里，这里不用重复 -->
        <!-- 详情弹窗（默认隐藏） -->
        <div class="history-detail" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center;">
            <div style="background: white; width: 90%; max-width: 500px; border-radius: 12px; padding: 20px; max-height: 80vh; overflow-y: auto;">
                <!-- 详情标题（蓝色） -->
                <div style="color: #4361ee; font-size: 18px; font-weight: bold; margin-bottom: 20px;">记录 #<span id="detailId"></span></div>
                
                <!-- 详情内容（黑色） -->
                <div style="color: #333; line-height: 1.6;">
                    <div style="margin-bottom: 15px;"><strong>时间：</strong><span id="detailTime"></span></div>
                    <div style="margin-bottom: 15px;"><strong>加密层数：</strong><span id="detailLayers"></span></div>
                    <div style="margin-bottom: 15px;">
                        <strong>原始内容：</strong><br>
                        <div style="margin-top: 5px; padding: 10px; background: #f5f5f5; border-radius: 6px; white-space: pre-wrap;" id="detailOriginal"></div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>加密结果：</strong><br>
                        <div style="margin-top: 5px; padding: 10px; background: #f5f5f5; border-radius: 6px; white-space: pre-wrap;" id="detailEncrypted"></div>
                    </div>
                </div>
                
                <!-- 返回按钮 -->
                <div style="margin-top: 20px; text-align: center;">
                    <button id="backFromDetailBtn" style="padding: 10px 20px; background: #4361ee; color: white; border: none; border-radius: 30px; cursor: pointer;">返回列表</button>
                </div>
            </div>
        </div>
    </div>
</div>


    <script>
    // 先获取校验界面的元素
const checkingContainer = document.getElementById('checkingContainer');

// 1. 从链接获取内容
fetch('https://neverrest-studio.github.io/neverrestaesencryption-jc.html')
  .then(response => response.text()) // 读取文本内容
  .then(text => {
    // 2. 等待1秒钟（让圆圈转够1秒）
    setTimeout(() => {
      if (text.trim() === '行') {
        // 3. 如果是"行"，就隐藏校验界面，进入正常页面
        checkingContainer.style.display = 'none';
      } else if (text.trim() === '停') {
        // 4. 如果是"停"，就显示"校验不通过"
        checkingContainer.innerHTML = '<div class="failed-check">校验不通过，请稍后再试！</div>';
      }
    }, 1000); // 这里的1000就是1秒
  });

        const passwordUrl = "https://neverrest-studio.github.io/neverrestaesencryption-hd.html";
        
        // 全局变量
        let authPassword = '';
        let currentPassword = '';
        let isAuthenticated = false;
        let failedAttempts = 0;
        let lockUntil = 0;
        let storedData = JSON.parse(localStorage.getItem('secureAESData')) || [];
        let isRecoveryMode = false;

        // DOM元素
        const authContainer = document.getElementById('authContainer');
        const passwordDisplay = document.getElementById('passwordDisplay');
        const numpadBtns = document.querySelectorAll('.num-btn[data-number]');
        const backspaceBtn = document.getElementById('backspaceBtn');
        const submitAuthBtn = document.getElementById('submitAuthBtn');
        const mainContainer = document.getElementById('mainContainer');
        const checkmark = document.querySelector('.checkmark');
        const crossmark = document.querySelector('.crossmark');
        const errorContainer = document.getElementById('errorContainer');
        const backBtn = document.getElementById('backBtn');
        const lockContainer = document.getElementById('lockContainer');
        const lockTimer = document.getElementById('lockTimer');
        const recoveryBtn = document.getElementById('recoveryBtn');
        const recoveryContainer = document.getElementById('recoveryContainer');
        const closeRecoveryBtn = document.getElementById('closeRecoveryBtn');
        const recoveryBody = document.getElementById('recoveryBody');

        // 初始化
        async function init() {
            // 检查是否被锁定
            checkLockStatus();
            
            // 获取远程密码
            await fetchRemotePassword();
            
            // 数字按钮事件
            numpadBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    if (authPassword.length < 6) {
                        authPassword += btn.dataset.number;
                        updatePasswordDisplay();
                    }
                });
            });
            
            // 退格按钮
            backspaceBtn.addEventListener('click', () => {
                authPassword = authPassword.slice(0, -1);
                updatePasswordDisplay();
            });
            
            // 提交按钮
            submitAuthBtn.addEventListener('click', checkAuthPassword);
            
            // 返回按钮
            backBtn.addEventListener('click', () => {
                errorContainer.classList.remove('active');
                authPassword = '';
                updatePasswordDisplay();
            });
            
            // 找回数据按钮
            recoveryBtn.addEventListener('click', () => {
                isRecoveryMode = true;
                authContainer.style.display = 'flex';
                mainContainer.style.display = 'none';
                authPassword = '';
                updatePasswordDisplay();
            });
            
            closeRecoveryBtn.addEventListener('click', closeRecovery);
            
            // 初始化主界面
            initMainInterface();
        }

        // 检查锁定状态
        function checkLockStatus() {
            const now = Date.now();
            const lockTime = localStorage.getItem('lockTime');
            failedAttempts = parseInt(localStorage.getItem('failedAttempts')) || 0;
            
            if (lockTime && now < parseInt(lockTime)) {
                lockUntil = parseInt(lockTime);
                startLockTimer();
                return;
            }
            
            // 清除锁定状态
            if (lockTime) {
                localStorage.removeItem('lockTime');
                failedAttempts = 0;
                lockUntil = 0;
            }
        }

        // 开始锁定计时器
        function startLockTimer() {
            authContainer.style.display = 'none';
            lockContainer.classList.add('active');
            
            const updateTimer = () => {
                const now = Date.now();
                const remaining = Math.max(0, lockUntil - now);
                
                if (remaining <= 0) {
                    lockContainer.classList.remove('active');
                    authContainer.style.display = 'flex';
                    localStorage.removeItem('lockTime');
                    localStorage.removeItem('failedAttempts');
                    failedAttempts = 0;
                    lockUntil = 0;
                    return;
                }
                
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                lockTimer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                setTimeout(updateTimer, 1000);
            };
            
            updateTimer();
        }

        // 更新密码显示
        function updatePasswordDisplay() {
            passwordDisplay.textContent = '*'.repeat(authPassword.length);
            passwordDisplay.classList.toggle('active', authPassword.length > 0);
        }

        // 获取远程密码
        async function fetchRemotePassword() {
            try {
                const response = await fetch(passwordUrl);
                if (!response.ok) throw new Error('Network error');
                const text = await response.text();
                
                // 验证是否为6位数字
                if (/^\d{6}$/.test(text)) {
                    currentPassword = text;
                } else {
                    throw new Error('服务器已被关闭');
                }
            } catch (error) {
                console.error('服务器已被关闭:', error);
                showAlert('无法连接服务器，请检查网络连接', 'error');
            }
        }

        // 检查认证密码
        function checkAuthPassword() {
            if (authPassword.length !== 6) {
                showAuthFeedback(false);
                return;
            }
            
            if (authPassword === currentPassword) {
                showAuthFeedback(true, () => {
                    if (isRecoveryMode) {
                        // 找回数据模式
                        isRecoveryMode = false;
                        authContainer.style.display = 'none';
                        recoveryContainer.classList.add('active');
                        renderRecoveryData();
                    } else {
                        // 正常登录模式
                        authContainer.style.display = 'none';
                        mainContainer.style.display = '';
                        isAuthenticated = true;
                    }
                    
                    // 重置失败尝试
                    failedAttempts = 0;
                    localStorage.removeItem('failedAttempts');
                });
            } else {
                failedAttempts++;
                localStorage.setItem('failedAttempts', failedAttempts);
                
                if (failedAttempts >= 5) {
                    // 锁定系统1分钟
                    lockUntil = Date.now() + 1 * 60 * 1000;
                    localStorage.setItem('lockTime', lockUntil.toString());
                    startLockTimer();
                } else {
                    showAuthFeedback(false, () => {
                        errorContainer.classList.add('active');
                    });
                }
            }
        }

        // 显示认证反馈
        function showAuthFeedback(success, callback) {
            const mark = success ? checkmark : crossmark;
            
            // 重置动画
            mark.querySelector('path').style.strokeDashoffset = '1000';
            mark.querySelector('path').style.animation = 'none';
            void mark.querySelector('path').offsetWidth; // 触发重绘
            
            // 显示并运行动画
            mark.style.opacity = '1';
            mark.querySelector('path').style.animation = 'draw 0.8s ease forwards';
            
            setTimeout(() => {
                mark.style.opacity = '0';
                if (callback) callback();
            }, 1000);
        }

        // 初始化主界面
        function initMainInterface() {
            // 加密层数控制
            const layerDisplay = document.getElementById('layerDisplay');
            const decreaseLayer = document.getElementById('decreaseLayer');
            const increaseLayer = document.getElementById('increaseLayer');
            
            let layers = 1;
            
            decreaseLayer.addEventListener('click', () => {
                if (layers > 1) {
                    layers--;
                    layerDisplay.textContent = layers;
                    updateEncryptPasswordInputs(layers);
                }
            });
            
            increaseLayer.addEventListener('click', () => {
                if (layers < 10) {
                    layers++;
                    layerDisplay.textContent = layers;
                    updateEncryptPasswordInputs(layers);
                }
            });
            
            // 解密密层数控制
            const decryptLayerDisplay = document.getElementById('decryptLayerDisplay');
            const decreaseDecryptLayer = document.getElementById('decreaseDecryptLayer');
            const increaseDecryptLayer = document.getElementById('increaseDecryptLayer');
            
            let decryptLayers = 1;
            
            decreaseDecryptLayer.addEventListener('click', () => {
                if (decryptLayers > 1) {
                    decryptLayers--;
                    decryptLayerDisplay.textContent = decryptLayers;
                    updateDecryptPasswordInputs(decryptLayers);
                }
            });
            
            increaseDecryptLayer.addEventListener('click', () => {
                if (decryptLayers < 10) {
                    decryptLayers++;
                    decryptLayerDisplay.textContent = decryptLayers;
                    updateDecryptPasswordInputs(decryptLayers);
                }
            });
            
            // 初始化密码输入框
            updateEncryptPasswordInputs(layers);
            updateDecryptPasswordInputs(decryptLayers);
            
            // 标签页切换
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });
            
            // 加密按钮
            document.getElementById('encryptBtn').addEventListener('click', function() {
  const text = document.getElementById('encryptText').value;
  const layers = parseInt(document.getElementById('layerDisplay').textContent);
  
  if (!text) {
    showAlert('请输入要加密的内容', 'error');
    return;
  }
  
  try {
    const passwords = getEncryptPasswords(layers);
    const encrypted = multiLayerEncrypt(text, passwords);
    
    // 显示弹窗，填充结果
    document.getElementById('popupResultContent').textContent = encrypted;
    document.getElementById('resultPopup').style.display = 'flex'; // 显示弹窗
    
    // 保存记录（原来的功能保留）
    const record = {
      id: Date.now(),
      timestamp: new Date().toLocaleString(),
      layers: layers,
      passwords: passwords,
      originalText: text,
      encryptedText: encrypted
    };
    storedData.unshift(record);
    if (storedData.length > 20) storedData.pop();
    localStorage.setItem('secureAESData', JSON.stringify(storedData));
    
    showAlert(`成功应用 ${layers} 层加密！`);
  } catch (error) {
    showAlert('加密失败: ' + error.message, 'error');
    console.error(error);
  }
});

            
            // 解密按钮
            document.getElementById('decryptBtn').addEventListener('click', function() {
  const text = document.getElementById('decryptText').value;
  const layers = parseInt(document.getElementById('decryptLayerDisplay').textContent);
  
  if (!text) {
    showAlert('请输入要解密的内容', 'error');
    return;
  }
  
  try {
    const passwords = getDecryptPasswords(layers);
    const decrypted = multiLayerDecrypt(text, passwords);
    
    // 显示弹窗，填充结果
    document.getElementById('popupResultContent').textContent = decrypted;
    document.getElementById('resultPopup').style.display = 'flex'; // 显示弹窗
    
    showAlert(`成功解密 ${layers} 层加密！`);
  } catch (error) {
    showAlert('解密失败: ' + error.message, 'error');
    console.error(error);
  }
});

        }

        // 更新加密密码输入框
        function updateEncryptPasswordInputs(layers) {
            const container = document.getElementById('encryptPasswordContainer');
            container.innerHTML = '';
            
            for (let i = 1; i <= layers; i++) {
                const div = document.createElement('div');
                div.className = 'layer-password';
                
                const label = document.createElement('label');
                label.textContent = `第 ${i} 层密码:`;
                label.htmlFor = `encryptPassword${i}`;
                
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `encryptPassword${i}`;
                input.placeholder = `输入第 ${i} 层密码`;
                
                div.appendChild(label);
                div.appendChild(input);
                container.appendChild(div);
            }
        }

        // 更新解密码输入框
        function updateDecryptPasswordInputs(layers) {
            const container = document.getElementById('decryptPasswordContainer');
            container.innerHTML = '';
            
            for (let i = 1; i <= layers; i++) {
                const div = document.createElement('div');
                div.className = 'layer-password';
                
                const label = document.createElement('label');
                label.textContent = `第 ${i} 层密码:`;
                label.htmlFor = `decryptPassword${i}`;
                
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `decryptPassword${i}`;
                input.placeholder = `输入第 ${i} 层密码`;
                
                div.appendChild(label);
                div.appendChild(input);
                container.appendChild(div);
            }
        }

        // 显示提示信息
        function showAlert(message, type = 'success') {
            const alertBox = document.getElementById('alertBox');
            alertBox.className = `alert alert-${type}`;
            alertBox.textContent = message;
            alertBox.style.display = 'block';
            
            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 5000);
        }

        // 复制到剪贴板
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const range = document.createRange();
            range.selectNode(element);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
            
            showAlert('已复制到剪贴板！');
        }

        // 多层加密函数
        function multiLayerEncrypt(text, passwords) {
            let encrypted = text;
            for (const password of passwords) {
                encrypted = CryptoJS.AES.encrypt(encrypted, password).toString();
            }
            return encrypted;
        }

        // 多层解密函数
        function multiLayerDecrypt(text, passwords) {
            let decrypted = text;
            // 需要反向解密，从最后一层开始
            for (let i = passwords.length - 1; i >= 0; i--) {
                const bytes = CryptoJS.AES.decrypt(decrypted, passwords[i]);
                decrypted = bytes.toString(CryptoJS.enc.Utf8);
                
                if (!decrypted) {
                    throw new Error(`第 ${passwords.length - i} 层解密失败，密码可能错误`);
                }
            }
            return decrypted;
        }

        // 获取所有加密密码
        function getEncryptPasswords(layers) {
            const passwords = [];
            
            for (let i = 1; i <= layers; i++) {
                const password = document.getElementById(`encryptPassword${i}`).value;
                if (!password) {
                    throw new Error(`请输入第 ${i} 层密码`);
                }
                passwords.push(password);
            }
            
            return passwords;
        }

        // 获取所有解密密码
        function getDecryptPasswords(layers) {
            const passwords = [];
            
            for (let i = 1; i <= layers; i++) {
                const password = document.getElementById(`decryptPassword${i}`).value;
                if (!password) {
                    throw new Error(`请输入第 ${i} 层密码`);
                }
                passwords.push(password);
            }
            
            return passwords;
        }

        // 加密数据
        function encryptData() {
            const text = document.getElementById('encryptText').value;
            const layers = parseInt(document.getElementById('layerDisplay').textContent);
            
            if (!text) {
                showAlert('请输入要加密的内容', 'error');
                return;
            }
            
            try {
                const passwords = getEncryptPasswords(layers);
                const encrypted = multiLayerEncrypt(text, passwords);
                
                // 保存记录
                const record = {
                    id: Date.now(),
                    timestamp: new Date().toLocaleString(),
                    layers: layers,
                    passwords: passwords,
                    originalText: text,
                    encryptedText: encrypted
                };
                
                storedData.unshift(record); // 添加到开头
                if (storedData.length > 20) storedData.pop(); // 限制记录数量
                localStorage.setItem('secureAESData', JSON.stringify(storedData));
                
                // 显示结果
                document.getElementById('encryptedOutput').textContent = encrypted;
                document.getElementById('encryptResult').style.display = 'block';
                showAlert(`成功应用 ${layers} 层加密！`);
            } catch (error) {
                showAlert('加密失败: ' + error.message, 'error');
                console.error(error);
            }
        }

        // 解密数据
        function decryptData() {
            const text = document.getElementById('decryptText').value;
            const layers = parseInt(document.getElementById('decryptLayerDisplay').textContent);
            
            if (!text) {
                showAlert('请输入要解密的内容', 'error');
                return;
            }
            
            try {
                const passwords = getDecryptPasswords(layers);
                const decrypted = multiLayerDecrypt(text, passwords);
                
                document.getElementById('decryptedOutput').textContent = decrypted;
                document.getElementById('decryptResult').style.display = 'block';
                showAlert(`成功解密 ${layers} 层加密！`);
            } catch (error) {
                showAlert('解密失败: ' + error.message, 'error');
                console.error(error);
            }
        }

        // 关闭找回数据界面
        function closeRecovery() {
            recoveryContainer.classList.remove('active');
            authContainer.style.display = 'none';
            mainContainer.style.display = '';
        }

// 渲染历史记录列表（显示小框）
function renderRecoveryData() {
    // 找到放小框的容器（新列表容器）
    const historyList = document.querySelector('.history-list');
    historyList.innerHTML = ''; // 先清空容器
    
    // 如果没有记录，显示“暂无历史记录”
    if (storedData.length === 0) {
        historyList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">暂无历史记录</div>';
        return;
    }
    
    // 遍历所有记录，生成小框
    storedData.forEach((record, index) => {
        // 创建一个小框
        const item = document.createElement('div');
        item.className = 'history-item'; // 用上面加的CSS样式
        
        // 取原始内容前6个字，超过就加...
        let previewText = record.originalText || '无内容'; // 如果没有内容，显示“无内容”
        if (previewText.length > 6) {
            previewText = previewText.substring(0, 6) + '...'; // 截取前6个字
        }
        
        // 小框里的内容：左边显示预览文字，右边显示“查看”按钮
        item.innerHTML = `
            <div class="content-preview">${previewText}</div>
            <button class="view-btn" data-index="${index}">查看</button>
        `;
        
        // 把小框放到列表里
        historyList.appendChild(item);
    });
    
    // 给所有“查看”按钮加点击事件
    document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const index = this.getAttribute('data-index'); // 拿到点击的是第几个记录
            showDetail(index); // 调用显示详情的函数
        });
    });
}

// 显示详情页
function showDetail(index) {
    const record = storedData[index]; // 拿到对应的记录数据
    if (!record) return; // 如果没数据，不执行
    
    // 给详情页的占位符填内容
    document.getElementById('detailId').textContent = record.id; // 记录ID
    document.getElementById('detailTime').textContent = record.timestamp; // 时间
    document.getElementById('detailLayers').textContent = record.layers; // 加密层数
    document.getElementById('detailOriginal').textContent = record.originalText || '无'; // 原始内容
    document.getElementById('detailEncrypted').textContent = record.encryptedText || '无'; // 加密结果
    
    // 显示详情页（把display: none改成flex）
    document.querySelector('.history-detail').style.display = 'flex';
}

// 给“返回列表”按钮加事件（关闭详情页）
document.getElementById('backFromDetailBtn').addEventListener('click', function() {
    document.querySelector('.history-detail').style.display = 'none';
});


        // 加载找回的数据项
        function loadRecoveryItem(id) {
            const item = storedData.find(d => d.id === id);
            if (!item) return;
            
            // 切换到加密标签页
            document.querySelector('.tab[data-tab="encrypt"]').click();
            
            // 设置层数
            document.getElementById('layerDisplay').textContent = item.layers;
            updateEncryptPasswordInputs(item.layers);
            
            // 填充密码
            for (let i = 0; i < item.layers; i++) {
                document.getElementById(`encryptPassword${i+1}`).value = item.passwords[i];
            }
            
            // 填充内容
            document.getElementById('encryptText').value = item.originalText;
            
            // 关闭找回界面
            closeRecovery();
            
            showAlert('已加载历史记录');
        }

        // 暴露给全局的方法
        window.loadRecoveryItem = loadRecoveryItem;
        window.copyToClipboard = copyToClipboard;

        // 初始化应用
        init();
    // 弹窗复制按钮功能
document.getElementById('copyPopupBtn').addEventListener('click', function() {
  const resultText = document.getElementById('popupResultContent').textContent;
  navigator.clipboard.writeText(resultText).then(function() {
    showAlert('结果已复制到剪贴板！');
  });
});

// 弹窗返回按钮功能（清空所有输入，关闭弹窗）
document.getElementById('backPopupBtn').addEventListener('click', function() {
  // 清空加密相关输入
  document.getElementById('encryptText').value = '';
  document.getElementById('encryptResult').style.display = 'none';
  // 清空解密相关输入
  document.getElementById('decryptText').value = '';
  document.getElementById('decryptResult').style.display = 'none';
  // 清空所有密码框
  document.querySelectorAll('#encryptPasswordContainer input, #decryptPasswordContainer input').forEach(input => {
    input.value = '';
  });
  // 关闭弹窗
  document.getElementById('resultPopup').style.display = 'none';
});
    // 清除历史记录按钮功能
document.getElementById('clearHistoryBtn').addEventListener('click', function() {
  // 弹出确认框，防止误点
  if (confirm('确定要删除所有历史记录吗？删除后无法恢复！')) {
    // 清空本地存储的历史数据
    storedData = [];
    localStorage.removeItem('secureAESData');
    // 刷新历史记录界面（变成空的）
    renderRecoveryData();
    // 提示删除成功
    showAlert('所有历史记录已清除');
  }
});
// 通用打开函数：传容器 ID
function openModal(modalId) {
  const modal = document.getElementById(modalId);
  modal.classList.add('show');
  modal.style.display = 'block';
}

// 通用关闭函数：传容器 ID
function closeModal(modalId) {
  const modal = document.getElementById(modalId);
  modal.classList.remove('show');
  setTimeout(() => {
    modal.style.display = 'none';
  }, 300); // 等过渡结束
}

    </script>
</body>
</html>